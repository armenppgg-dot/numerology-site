const monthSelect = document.getElementById('month');
const daySelect = document.getElementById('day');
const yearSelect = document.getElementById('year');
const calculateBtn = document.getElementById('calculate');
const errorEl = document.getElementById('error');
const resultSection = document.getElementById('result');
const resultTitle = document.getElementById('result-title');
const resultContent = document.getElementById('result-content');
const telegramLink = document.getElementById('telegram-link');

const TELEGRAM_USERNAME = 'daryapogosyan';

const monthNames = ['Месяц', 'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];

const profiles = {
  1: { name: 'Лидер', power: 'инициировать новое и вести людей через личный пример', risk: 'излишний контроль и нетерпение к чужому темпу', relation: 'уважение, честность и пространство для самостоятельности', money: 'собственные проекты, управление и запуск смелых идей', energy: 'спорт, короткие цели, регулярный отдых от постоянной ответственности', lesson: 'руководить без давления и слышать партнёрство' },
  2: { name: 'Гармонизатор', power: 'чувствовать нюансы, объединять людей и создавать атмосферу доверия', risk: 'зависимость от чужой оценки и страх конфликтов', relation: 'мягкий диалог, ясные договорённости и эмоциональная безопасность', money: 'командная работа, помощь людям, сервис и дипломатия', energy: 'тишина, музыка, прогулки и телесные практики на заземление', lesson: 'сохранять доброту, не предавая собственные границы' },
  3: { name: 'Творец', power: 'вдохновлять словом, образами и лёгкостью самовыражения', risk: 'распыление и откладывание важного из-за поиска идеального настроения', relation: 'живой интерес, юмор, искренние разговоры и совместное творчество', money: 'контент, обучение, публичные форматы и креативные продукты', energy: 'ритм дня, дисциплина и завершение начатого в небольших циклах', lesson: 'превращать талант в системный результат' },
  4: { name: 'Строитель', power: 'создавать устойчивые системы, порядок и надёжный фундамент', risk: 'жёсткость, тревога перед переменами и перфекционизм', relation: 'предсказуемость, верность и совместные практичные цели', money: 'долгие стратегии, аналитика, структура и профессиональная репутация', energy: 'режим сна, физическая активность и чередование труда с восстановлением', lesson: 'учиться гибкости без потери стабильности' },
  5: { name: 'Исследователь', power: 'адаптация, свобода мышления и быстрая реакция на изменения', risk: 'импульсивность и усталость от постоянной смены фокуса', relation: 'честность, новизна и уважение личной свободы в паре', money: 'динамичные сферы, продажи, медиа, путешествия и проекты с движением', energy: 'осознанные паузы, дыхательные практики и приоритеты на неделю', lesson: 'сохранять свободу, оставаясь в ответственности' },
  6: { name: 'Наставник', power: 'забота, зрелость и умение создавать тёплое пространство', risk: 'спасательство и перенапряжение из-за чужих задач', relation: 'взаимность, поддержка и уважение к потребностям обоих', money: 'консалтинг, обучение, эстетика, сервис и профессии помощи', energy: 'личные границы, творчество для себя и регулярное восстановление', lesson: 'давать любовь без самопожертвования' },
  7: { name: 'Аналитик', power: 'глубина мышления, интуиция и стремление к истинным смыслам', risk: 'закрытость, одиночество и гиперкритичность к себе', relation: 'интеллектуальная близость, доверие и уважение к внутреннему миру', money: 'исследования, экспертиза, консультации и авторские методики', energy: 'время в тишине, дневник наблюдений и мягкие телесные нагрузки', lesson: 'соединять мудрость ума с открытостью сердца' },
  8: { name: 'Стратег', power: 'управление ресурсами, амбиция и способность масштабировать', risk: 'жёсткость, эмоциональная дистанция и жизнь только через результат', relation: 'партнёрство на равных, ясные правила и уважение границ', money: 'бизнес, инвестиции, руководящие роли и финансовые стратегии', energy: 'баланс работы и личной жизни, контроль стресса и делегирование', lesson: 'соединять силу влияния с человечностью' },
  9: { name: 'Гуманист', power: 'широкий взгляд, эмпатия и умение вдохновлять на смысл', risk: 'идеализация, разочарование и эмоциональное выгорание', relation: 'душевная глубина, принятие и общие ценности', money: 'социальные проекты, творчество, образование и помогающие практики', energy: 'простые ритуалы, природа и ограничение информационного шума', lesson: 'служить миру, не теряя контакт с собой' },
  11: { name: 'Вы — тонкий проводник смысла, который чувствует людей между строк. В вас много света, и он заметен даже тогда, когда вы молчите. Число 11 часто приходит к тем, кто умеет вдохновлять не громкостью, а глубиной.', power: 'Ваша сила в живой интуиции: вы ловите направление раньше, чем оно становится очевидным. Вы умеете соединять сердце и идею так, что у других появляется вера в себя. Когда вы делитесь своим видением, вокруг словно загораются внутренние огни.', risk: 'Иногда поток чувств становится слишком плотным, и появляется усталость от собственных мыслей. В такие периоды легко начать сомневаться в себе и откладывать важные шаги. Вам важно не торопить себя, а бережно возвращаться к простым опорам дня.', relation: 'В любви вам нужна тихая глубина, где можно быть настоящим без масок. Вы раскрываетесь рядом с человеком, который слышит не только слова, но и паузы. Честный разговор и мягкость для вас важнее красивых обещаний.', money: 'Финансы у 11 растут там, где есть смысл, голос и личная энергия автора. Вам подходят направления, в которых можно вдохновлять, обучать, вести и создавать уникальный подход. Когда дело откликается душе, материальная стабильность приходит заметно легче.', energy: 'Ваш ресурс сохраняется через тишину, ритм и бережный контакт с телом. Небольшие ритуалы — прогулка, дыхание, ранний сон — работают для вас сильнее, чем резкие рывки. Чем меньше перегруза информацией, тем яснее внутренний компас.', lesson: 'Главный урок 11 — доверять своему внутреннему знанию и проявляться в мире смелее. Не прятать дар в ожидании идеального момента, а делать шаг за шагом уже сейчас. Если захотите, на глубоком разборе это можно превратить в понятный личный маршрут.' },
  22: { name: 'Вы — архитектор большой реальности, человек, который видит не только мечту, но и фундамент под неё. В числе 22 много зрелости, внутреннего масштаба и редкой собранности. Ваш путь — создавать то, что служит людям долго.', power: 'Ваша сила в умении превращать хаос в систему и идею в работающий результат. Вы чувствуете, как разложить сложное на ясные шаги и довести до формы. Там, где другим страшно от объёма, у вас включается стратегическое спокойствие.', risk: 'Иногда вы берёте на себя слишком много и живёте в режиме постоянной ответственности. На этом фоне может расти жёсткость к себе и страх ошибиться в крупном. Важно помнить: устойчивость рождается не из давления, а из разумного темпа.', relation: 'В отношениях вам близок союз, где есть надёжность, уважение и общая траектория. Вы цените партнёрство, в котором слова подтверждаются поступками каждый день. Тепло для вас раскрывается там, где есть и чувства, и договорённости.', money: 'Денежный поток 22 связан с крупными задачами, управлением и проектами с долгой перспективой. Вы умеете строить процессы, объединять людей и видеть экономику на несколько шагов вперёд. Когда вы не занижаете масштаб, доход становится стабильнее и выше.', energy: 'Вашу энергию лучше всего держат структура, приоритеты и регулярное восстановление. Чёткие этапы, паузы между рывками и внимание к телу помогают вам не выгорать. Для 22 качество ритма важнее количества сделанного за день.', lesson: 'Урок 22 — строить большое бережно к себе, без внутреннего кнута. Вам важно оставаться человеком, а не только функцией результата. На консультации это хорошо раскрывается через персональную стратегию нагрузки и опор.' },
  33: { name: 'Вы — сердце пространства, человек, рядом с которым другим становится теплее и спокойнее. Число 33 несёт мягкую силу любви, мудрости и вдохновляющего присутствия. Ваше влияние часто глубже, чем вы сами привыкли замечать.', power: 'Ваша сила в способности поддерживать так, что у человека возвращается вера в жизнь. Вы умеете говорить с душой — деликатно, точно и по-настоящему. Через ваше внимание люди вспоминают о своей ценности и внутреннем свете.', risk: 'Тень 33 — привычка забывать о себе, когда рядом кому-то тяжело. Отдавая слишком много, вы можете накопить эмоциональную усталость и тихое опустошение. Вам важно вовремя выбирать баланс между заботой о других и заботой о себе.', relation: 'В отношениях вы ищете глубину, нежность и честное взаимное участие. Для вас важна атмосфера, где можно и давать любовь, и свободно принимать её в ответ. Гармония приходит там, где есть равенство сердец, а не роль спасателя.', money: 'Финансово 33 раскрывается через дела, в которых есть польза, красота и человеческий смысл. Вам подходят проекты, где можно обучать, сопровождать, вдохновлять и создавать пространство роста. Когда вы цените свой вклад по-взрослому, доход становится устойчивым.', energy: 'Ваш ресурс восстанавливается через тишину, творчество и тёплые границы. Даже короткое время наедине с собой возвращает вам ясность и мягкую силу. Регулярная забота о теле и отдыхе для 33 — не роскошь, а основа стабильности.', lesson: 'Главный урок 33 — любить широко, не теряя собственный центр. Служение миру начинается с бережности к себе и уважения к своим пределам. Если будет отклик, в глубоком разборе это можно развернуть в очень личную и практичную систему опоры.' }
};

function fillSelect(select, items) {
  select.innerHTML = items.map((item) => `<option value="${item.value}">${item.label}</option>`).join('');
}

function initSelectors() {
  fillSelect(monthSelect, monthNames.map((name, i) => ({ value: i || '', label: name })));
  fillSelect(daySelect, [{ value: '', label: 'День' }, ...Array.from({ length: 31 }, (_, i) => ({ value: i + 1, label: i + 1 }))]);

  const currentYear = new Date().getFullYear();
  const years = [{ value: '', label: 'Год' }];
  for (let y = currentYear; y >= 1900; y -= 1) {
    years.push({ value: y, label: y });
  }
  fillSelect(yearSelect, years);
}

function sumDigits(input) {
  return String(input).split('').reduce((acc, digit) => acc + Number(digit), 0);
}

function calcLifePath(day, month, year) {
  let total = sumDigits(`${day}${month}${year}`);
  while (total > 9 && ![11, 22, 33].includes(total)) {
    total = sumDigits(total);
  }
  return total;
}

function isValidDate(day, month, year) {
  const date = new Date(year, month - 1, day);
  return date.getFullYear() === year && date.getMonth() === month - 1 && date.getDate() === day;
}

function buildParagraphs(number) {
  const p = profiles[number];
  return [
    `Число судьбы ${number} — это архетип «${p.name}». В вашем характере естественно проявляется способность ${p.power}. Вы быстро замечаете, где нужна инициатива, поддержка или трезвая структура, и часто становитесь точкой сборки для других людей. Когда вы признаёте свои сильные стороны без внутреннего обесценивания, жизненные решения становятся спокойнее, точнее и дают устойчивый результат.`,
    `В период стресса у этого числа может проявляться ${p.risk}. Обычно такое состояние начинается незаметно: растёт внутреннее напряжение, усиливается критика к себе и пропадает ощущение опоры. Важно не бороться с собой, а вовремя замечать сигналы усталости, возвращаться к базовым ритуалам и выбирать посильный темп. Именно мягкая дисциплина, а не рывки, постепенно возвращает ясность и уверенность.`,
    `В отношениях ваша формула гармонии — ${p.relation}. Вам особенно важно говорить о чувствах и потребностях простыми словами, не накапливая недосказанность. Когда диалог строится на уважении и ответственности с двух сторон, уходит тревожный контроль и появляется близость. Такая модель делает личную жизнь не полем борьбы, а пространством роста, поддержки и взаимного развития.`,
    `Финансовая реализация числа ${number} чаще всего раскрывается через ${p.money}. Деньги приходят легче, когда вы опираетесь на собственную ценность и не сравниваете свой путь с чужими стандартами. Полезно фиксировать конкретные шаги на месяц, отслеживать прогресс и регулярно корректировать стратегию. Системный подход помогает снизить хаос, сохранить ресурс и укрепить чувство профессиональной устойчивости.`,
    `Чтобы сохранить ресурс в долгую, вашему числу подходят практики, связанные с направлением «${p.energy}». Это не про идеальный режим, а про реалистичные привычки, которые поддерживают нервную систему и возвращают контакт с телом. Даже небольшие, но регулярные действия дают заметный эффект: меньше эмоциональных качелей, больше внутренней собранности, ясных приоритетов и спокойной энергии на важные решения.`,
    `Главный урок этого пути — ${p.lesson}. На консультации мы переводим это из красивой идеи в рабочий жизненный план: определяем ваши сильные опоры, убираем повторяющиеся сценарии, формируем конкретные шаги и опорные точки на ближайшие недели. Так число судьбы перестаёт быть абстракцией и становится понятным инструментом, который помогает жить осмысленно, устойчиво и в контакте с собой.`
  ];
}

calculateBtn.addEventListener('click', () => {
  const day = Number(daySelect.value);
  const month = Number(monthSelect.value);
  const year = Number(yearSelect.value);

  errorEl.hidden = true;

  if (!day || !month || !year) {
    errorEl.textContent = 'Пожалуйста, выберите месяц, день и год.';
    errorEl.hidden = false;
    return;
  }

  if (!isValidDate(day, month, year)) {
    errorEl.textContent = 'Проверьте корректность даты рождения.';
    errorEl.hidden = false;
    return;
  }

  const number = calcLifePath(day, month, year);
  const paragraphs = buildParagraphs(number);

  resultTitle.textContent = `Ваше число судьбы: ${number} (${profiles[number].name})`;
  resultContent.innerHTML = paragraphs.map((text) => `<p>${text}</p>`).join('');

  resultSection.hidden = false;
  resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
});


function initScrollReveal() {
  const revealBlocks = document.querySelectorAll('.reveal-on-scroll');
  if (!revealBlocks.length) {
    return;
  }

  if (!('IntersectionObserver' in window)) {
    revealBlocks.forEach((block) => block.classList.add('is-visible'));
    return;
  }

  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        obs.unobserve(entry.target);
      }
    });
  }, { threshold: 0.18 });

  revealBlocks.forEach((block) => observer.observe(block));
}

initSelectors();
initScrollReveal();

if (telegramLink) {
  telegramLink.href = `https://t.me/${TELEGRAM_USERNAME}`;
}
